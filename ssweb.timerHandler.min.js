/*! 
 * SSweb timerHandler扩展 (需要 ssweb.query 或 jQuery 或 Zepto支持 )
 * 定时器插件支持动态注册管理，支持已ms/s/m/h时间设置间隔周期时间、暂停、限制运行次数及自动销毁机制
 * @version 1.0.2 01/30/2018
 * @author ygzhang.cn@msn.com
 * @link https://github.com/ygzhang-cn/timerHandler
 * @copyright 2015-2018 Kunming Dongring Technology Co., Ltd.
 * -----------------------------------------------------
 */
 !function(t,n){"use strict";n.length<0&&console.warn("SSweb not loaded");var i=t||this.window||!1;if(n.isFunction(n.timerHandler))return n.timerHandler;var e=function(t){this._name=t,this._timer=null,this._interval=0,this._limit=0,this._counter=0,this._callback=!1,this._callbackStart=!1,this._callbackStartEnd=!1,this._callbackPause=!1,this._callbackPauseEnd=!1,this._callbackStop=!1,this._callbackStopEnd=!1,this._runing=0,this._bindDom=!1};e.prototype={time:function(t){if(void 0==t||null==t)throw new Error("timerHandler.time(`value`) must be a string or number");var i={s:1e3,ms:1,m:6e4,h:36e5},e=/^([0-9]+)\s*([smh]+)?$/.exec(n.trim(t.toString()));if(e&&e.length>1){var a=parseFloat(e[1]),o=i[e[2]]||1;this._interval=parseInt(a*o)}else this._interval=t;return this},limit:function(t){return"number"==typeof t?this._limit=parseInt(t):console.info("timerHandler.limit(`value`) must be a integer"),this},bindDom:function(t){if(void 0==t||null==t)throw new Error("timerHandler.bindDom(`selector`) must be a string");if(i){this._bindDom=t;var e=this;n.isjQuery(t)||n.isZepto(t)?t.on("DOMNodeRemoved",function(){e.stop()}):n.query?n("body").on("DOMNodeRemoved",t,function(){e.stop()}):"undefined"!=typeof jQuery?jQuery("body").on("DOMNodeRemoved",t,function(){e.stop()}):"undefined"!=typeof Zepto&&Zepto("body").on("DOMNodeRemoved",t,function(){e.stop()})}return n.client.browser.isIE&&n.client.browser.version<9&&console.info("timerHandler.bindDom does not support IE7|IE8"),this},call:function(t){return n.isFunction(t)?this._callback=t:console.info("timerHandler.callback(`value`) must be a function"),this},callStart:function(t){return n.isFunction(t)&&(this._callbackStart=t),this},callStartEnd:function(t){return n.isFunction(t)&&(this._callbackStartEnd=t),this},callPause:function(t){return n.isFunction(t)&&(this._callbackPause=t),this},callPauseEnd:function(t){return n.isFunction(t)&&(this._callbackPauseEnd=t),this},callStop:function(t){return n.isFunction(t)&&(this._callbackStop=t),this},callStopEnd:function(t){return n.isFunction(t)&&(this._callbackStopEnd=t),this},start:function(){if(null===this._timer){var n=this,i=function(){0==n._runing&&(this._callbackStart&&this._callbackStart(),n._runing=1,0==n._limit||n._counter<n._limit?(n._counter++,!1===n._callback.call(n,n._counter)&&n.stop()):n.stop(),n._runing=0,this._callbackStartEnd&&this._callbackStartEnd())};this._timer=t.setInterval(i,this._interval)}return this},pause:function(){return a.data[this._name]&&(this._callbackPause&&this._callbackPause(),t.clearInterval(this._timer),this._timer=null,this._runing=0,this._callbackPauseEnd&&this._callbackPauseEnd()),this},stop:function(){if(a.data[this._name]){if(this._callbackStop&&this._callbackStop(),t.clearInterval(this._timer),this._bindDom&&i){n.isjQuery(this._bindDom)||n.isZepto(this._bindDom)?this._bindDom.off("DOMNodeRemoved"):n.query?n("body").off("DOMNodeRemoved",this._bindDom):"undefined"!=typeof jQuery?jQuery("body").off("DOMNodeRemoved",this._bindDom):"undefined"!=typeof Zepto&&Zepto("body").off("DOMNodeRemoved",this._bindDom)}return delete a.data[this._name],this._callbackStopEnd&&this._callbackStopEnd(),!0}return!1}};var a=function(t){var i;if("number"!=typeof t&&"string"!=typeof t||!(t.length>0))throw new Error("timerHandler(`name`) must be a string");return i=n.trim(t.toString()),a.data[i]||(a.data[i]=new e(i)),a.data[i]};a.data={},i&&(n.query?n(i).on("unload",function(){for(var t in a.data)a.data[t].stop()}):"undefined"!=typeof jQuery?jQuery(i).on("unload",function(){for(var t in a.data)a.data[t].stop()}):"undefined"!=typeof Zepto&&Zepto(i).on("unload",function(){for(var t in a.data)a.data[t].stop()})),n.timerHandler=a}(window,SSweb);